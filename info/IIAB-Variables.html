<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>IIAB-Variables</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1
id="this-docs-currently-being-rewritten-in-2023-suggestions-appreciated"><em><strong>[THIS
DOC’S CURRENTLY BEING REWRITTEN IN 2023! SUGGESTIONS
APPRECIATED!]</strong></em></h1>
<h1 id="internet-in-a-box-iiab-variables">Internet-in-a-Box (IIAB)
Variables</h1>
<h2 id="configuration-variables">Configuration Variables</h2>
<p><a href="https://internet-in-a-box.org">Internet-in-a-Box</a> (IIAB)
uses <a
href="FAQ.html#What_is_Ansible_and_what_version_should_I_use%3F">Ansible</a>
playbooks to install IIAB software and any IIAB apps you choose. A
sequence of operations and a set of conventions define variables of
differing scope[*] to organize your IIAB installation(s).</p>
<p>[*] Though most IIAB/Ansible variables are global variables, as a
practical matter.</p>
<h2 id="facts">Facts</h2>
<p>When <a
href="Technical-Contributors-Guide.html#female_detective-understanding-ansible">Ansible</a>
starts it gathers a long list of <a
href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_vars_facts.html">‘facts’</a>
about the host on which installation will take place. It also permits a
<a
href="https://github.com/iiab/iiab/blob/master/scripts/local_facts.fact">local_facts
script</a> to gather any additional facts, helpful to installing IIAB
and IIAB apps.</p>
<p>Ansible explores hardware and OS, setting a <a
href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_vars_facts.html#ansible-facts">large
number of variables</a> with prefix <code>ansible_</code> (aside:
Ansible’s <a
href="https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html">special,
magic and connection variables</a> are similar).</p>
<h2 id="variable-files">Variable Files</h2>
<p>Two var files are most important:</p>
<ul>
<li><a
href="https://github.com/iiab/iiab/blob/master/vars/default_vars.yml">/opt/iiab/iiab/vars/default_vars.yml</a>
holds default values for a large number of global IIAB variables, that
help with installation.</li>
<li><a
href="FAQ.html#What_is_local_vars.yml_and_how_do_I_customize_it%3F">/etc/iiab/local_vars.yml</a>
allows IIAB implementers to override default_vars.yml, and set any other
vars that might be necessary.
<!-- These parameters are either ones that a deployment may wish to override, such as iiab_domain, or global constants. --></li>
</ul>
<p>Several <a
href="https://github.com/iiab/iiab/tree/master/vars">suggested
local_vars.yml files</a> are available to choose from, to help you get
oriented. IIAB’s <a href="https://download.iiab.io">1-line installer</a>
will even help you copy one of these to <a
href="FAQ.html#What_is_local_vars.yml_and_how_do_I_customize_it%3F">/etc/iiab/local_vars.yml</a>
whereupon you’re invited to customize and edit .</p>
<p>Changes should NOT be made to default_vars.yml (changes will be
overwritten during any subsequent pull from the Git repository).</p>
<!--
Variables Set in the Admin Console
==================================

When installation is carried out using the [Admin Console](https://github.com/iiab/iiab-admin-console#admin-console-documentation) an additional variable file is populated, /etc/iiab/config_vars.yml, which is set via a graphical user interface.  Values in this file further override values in default_vars.yml and local_vars.yml files.  It should be kept in mind that the order of precedence of the variables files is that config_vars.yml overrides local_vars.yml, and local_vars.yml overrides default_vars.yml.  This is true whether the console is used to perform an install or one of the command line scripts.
-->
<!-- Computed or Derived Variables -->
<h2 id="local_facts.fact">local_facts.fact</h2>
<p>After Ansible has gathered its facts and loaded the variables files,
it starts running roles in the order given in the top-level
playbook.</p>
<p>For IIAB the first role is <a
href="https://github.com/iiab/iiab/tree/master/roles/0-init">0-init</a>.
It runs <strong>/etc/ansible/facts.d/local_facts.fact</strong> [*] to
establish about a dozen variables that will be broadly useful, when
installing or configuring IIAB and any needed IIAB apps.</p>
<p>[*] Copied from <a
href="https://github.com/iiab/iiab/blob/master/scripts/local_facts.fact">/opt/iiab/iiab/scripts/local_facts.fact</a>
to <code>/etc/ansible/facts.d/</code> by <a
href="https://github.com/iiab/iiab/blob/master/iiab-install">iiab-install</a>.</p>
<!-- the local_facts module and then sets any variables that are derived from any of the above in computed_vars.yml.  For this reason the prep tag needs to be included any time an install is done using tags only. -->
<h2 id="role-variables">Role Variables</h2>
<p>Each <a href="https://github.com/iiab/iiab/tree/master/roles">Ansible
role</a> can declare variables within its defaults/main.yml. These
variables have the lowest level of precedence — essentially only taking
effect when no value was set anywhere else.</p>
<p>Our convention is to define variables in this file to softcode
parameters and to make sure the variable will not be undefined if used
elsewhere. These may be thought of as role-specific constants (and are
particular useful during software development and QA!)</p>
<h2 id="install-and-enable">Install and Enable</h2>
<p>Almost every role
<!-- except those that are dependencies of other roles, like mysql, -->
has 2 global variables <code>&lt;role name&gt;_install</code> and
<code>&lt;role name&gt;_enabled</code>, that specify whether the role
should be installed / enabled (or disabled!)</p>
<p>NOTE: IIAB does NOT currently support uninstalling of roles a.k.a.
apps or services.</p>
<p>NOTE: If an IIAB app has been successfully installed, that will be
recorded within <strong>/etc/iiab/iiab_state.yml</strong> — do NOT
manually edit that file!</p>
<h2 id="hostname-and-domain">Hostname and Domain</h2>
<p>Hostname and Domain variables default to:</p>
<ul>
<li>iiab_hostname: box</li>
<li>iiab_domain: lan</li>
</ul>
<p>Hostname defaults to <code>box</code> but in the past was
<code>schoolserver</code> because that’s what OLPC XO laptops
expected.</p>
<p>You can change these variables in <a
href="FAQ.html#What_is_local_vars.yml_and_how_do_I_customize_it%3F">/etc/iiab/local_vars.yml</a>
(preferably prior to installing IIAB) and also after IIAB is installed,
e.g. using IIAB’s Admin Console.</p>
<!--
## Variables in YML Files

Ansible supports a set_fact command that can be used for variable assignment inside a particular yml file.  By convention these should only be local variables except for the use of this command in computed_vars.yml.
-->
<h2 id="use-of-variables-in-ansible-playbooks">Use of Variables in
Ansible Playbooks</h2>
<p>Here are the main IIAB playbooks in <a
href="https://github.com/iiab/iiab">/opt/iiab/iiab</a>:</p>
<!-- * iiab.yml - used by ./runtags & ./runansible, with config_vars.yml
* iiab-base.yml - for ./install-support to install OpenVPN (idea: prior to installing IIAB) -->
<ul>
<li>iiab-stages.yml - run by ./iiab-install (the only one that
front-loads roles/0-init/defaults/main.yml, as of July 2022!)</li>
<li>run-one-role.yml - run by ./runrole to manually run any role, or any
one stage (0-to-9)</li>
<li>iiab-network.yml - run by ./iiab-network runs <a
href="https://github.com/iiab/iiab/tree/master/roles/network">roles/network</a>
<!-- using config_vars.yml (just runs networking play) --></li>
<li><strike>iiab-from-console.yml - run by Admin Console’s “Install
Configured Options” using config_vars.yml</strike> [No longer used as of
July 2022?]</li>
<li>[Admin Console might generate others on-the-fly, then throw them
away]</li>
</ul>
<h2 id="settings-files-in-etciiab">Settings Files in /etc/iiab</h2>
<p>Customize this file so that <a
href="https://github.com/iiab/iiab/blob/master/iiab-install">iiab-install</a>
(and others) correctly install IIAB and install/enable/disable your
chosen IIAB apps:</p>
<ul>
<li><a
href="FAQ.html#What_is_local_vars.yml_and_how_do_I_customize_it%3F">local_vars.yml</a></li>
</ul>
<p>Please do NOT touch other files in <code>/etc/iiab</code> but feel
free to take a look — here are a few examples:</p>
<ul>
<li>iiab.env - essential variables during installation; holds STAGE
(counter) for iiab-install’s 9 steps in iiab-stages.yml</li>
<li>iiab.env.py, <strike>iiab.env.pyc</strike> - Python code/class to
read iiab.env (basically exports WWWROOT == /library/www/html for
iiab-refresh-wiki-docs, iiab-make-kiwix-lib)</li>
<li>iiab.ini - tracks what’s been installed, in sequence, with dates
(this state is recorded by iiab-install and <a
href="https://github.com/iiab/iiab/blob/master/runrole">runrole</a>)</li>
<li><strike>config_vars.yml - null file must be “{}”, further populated
by Admin Console’s “Save Configuration” button. Used by iiab.yml &amp;
iiab-from-console.yml with vars/default_vars.yml &amp;
/etc/iiab/local_vars.yml</strike></li>
<li>uuid - used by OpenVPN, for future analytics “fieldback”, currently
not used on RPi Zero W (<a
href="https://github.com/iiab/iiab/pull/271">#271</a>)
<!-- * openvpn_handle - human-readable machine identifier used by OpenVPN --></li>
<li>kiwix_catalog.json - downloaded from Kiwix.org when you click
“Refresh Kiwix Catalog” in Admin Console</li>
</ul>
<h2 id="order-of-execution-and-precedence">Order of Execution and
Precedence</h2>
<p>In order of execution:</p>
<ul>
<li>Get <a
href="Technical-Contributors-Guide.html#female_detective-understanding-ansible">Ansible</a>
facts including <a
href="https://github.com/iiab/iiab/blob/master/scripts/local_facts.fact">local
facts</a></li>
<li>Load any vars particular to <a
href="https://github.com/iiab/iiab/tree/master/roles">roles</a></li>
<li>Load <a
href="https://github.com/iiab/iiab/blob/master/roles/0-init/defaults/main.yml">roles/0-init/defaults/main.yml</a>
(<a
href="https://github.com/iiab/iiab/blob/master/iiab-stages.yml">iiab-stages.yml</a>
uses this one, BUT <a
href="https://github.com/iiab/iiab/blob/master/run-one-role.yml">run-one-role.yml</a>
and <a
href="https://github.com/iiab/iiab/blob/master/iiab-from-console.yml">iiab-from-console.yml</a>
do not)</li>
<li>Load <a
href="https://github.com/iiab/iiab/blob/master/vars/default_vars.yml">default_vars.yml</a></li>
<li>Load OS-dependent variables i.e. <a
href="https://github.com/iiab/iiab/tree/master/vars">/opt/iiab/iiab/vars</a>/{{
ansible_local.local_facts.os_ver }}.yml</li>
<li>Load <a
href="FAQ.html#What_is_local_vars.yml_and_how_do_I_customize_it%3F">local_vars.yml</a></li>
<li>Load <strong>iiab_state.yml</strong> (explained <a
href="#install-and-enable">above</a>)</li>
<li><strike>Load config_vars.yml (might still be used by Admin Console’s
<a
href="https://github.com/iiab/iiab-admin-console/blob/master/roles/cmdsrv/files/iiab-cmdsrv3.py#L3672">iiab-cmdsrv3.py</a>
around line 3672)</strike> [obsolete as of July 2022]</li>
<li><strike>Run computed_vars.yml (part of <a
href="https://github.com/iiab/iiab/tree/master/roles/0-init">0-init</a>)</strike>
[appears obsolete as of 2019?]</li>
</ul>
<p>If you want to understand the “22 levels” of variable precedence at a
deeper level, please see <a
href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#understanding-variable-precedence">Ansible’s
official doc</a>.</p>
<h2 id="related-docs">Related Docs</h2>
<ul>
<li><a href="IIAB-Architecture.html">IIAB
Architecture</a></li>
<li><a
href="Technical-Contributors-Guide.html">Technical
Contributors Guide</a></li>
</ul>
</body>
</html>
